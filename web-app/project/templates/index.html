<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Detecci√≥n EPP - Seguridad Industrial</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <!-- Header Corporativo -->
    <header class="header">
        <div class="header-title">
            üõ°Ô∏è Sistema de Detecci√≥n EPP y Reconocimiento Facial
        </div>
        <div class="header-controls">
            <div class="dropdown">
                <div class="header-btn" id="menuBtn" title="Men√∫">
                    ‚ò∞
                </div>
                <div class="dropdown-content">
                    <div class="dropdown-item disabled" id="addPersonBtn">
                        üë§ Agregar Persona
                    </div>
                    <div class="dropdown-item" id="viewExcelBtn">
                        üìä Ver Registros
                    </div>
                    <div class="dropdown-item" id="exportDataBtn">
                        üì§ Exportar Datos
                    </div>
                </div>
            </div>
            <div class="header-btn" id="refreshBtn" title="Refrescar Aplicaci√≥n">
                üîÑ
            </div>
        </div>
    </header>

    <!-- Container Principal -->
    <div class="main-container">
        <!-- Panel Izquierdo - Estados EPP y Cumplimiento -->
        <div class="left-panel">
            <!-- Grid de Estados EPP (4 elementos) -->
            <div class="epp-grid">
                <div class="epp-status" id="statusCasco">
                    <span class="epp-icon">‚õëÔ∏è</span>
                    <div class="epp-text">CASCO<br>NO DETECTADO</div>
                </div>
                <div class="epp-status" id="statusGafas">
                    <span class="epp-icon">ü•Ω</span>
                    <div class="epp-text">GAFAS<br>NO DETECTADAS</div>
                </div>
                <div class="epp-status" id="statusChaleco">
                    <span class="epp-icon">ü¶∫</span>
                    <div class="epp-text">CHALECO<br>NO DETECTADO</div>
                </div>
                <div class="epp-status" id="statusGuantes">
                    <span class="epp-icon">üß§</span>
                    <div class="epp-text">GUANTES<br>NO DETECTADOS</div>
                </div>
            </div>

            <!-- Gr√°fico Circular de Cumplimiento EPP -->
            <div class="compliance-section">
                <h3 class="compliance-title">Cumplimiento de EPP</h3>
                <div class="circular-progress">
                    <svg width="140" height="140" class="progress-ring">
                        <circle cx="70" cy="70" r="60" class="progress-ring-bg"></circle>
                        <circle cx="70" cy="70" r="60" class="progress-ring-fill" id="progressCircle" 
                                stroke-dasharray="0 377" stroke-dashoffset="0"></circle>
                    </svg>
                    <div class="progress-text" id="progressText">0%</div>
                </div>
                <div class="progress-subtitle">4 elementos EPP monitoreados</div>
            </div>

            <!-- Registro de Actividad -->
            <div class="activity-section">
                <h3 class="activity-title">
                    üìã Registro de Actividad
                </h3>
                <div class="activity-log" id="activityLog">
                    <div class="activity-item">
                        <div class="activity-time">--:--</div>
                        <div class="activity-message">Sistema iniciado - Esperando detecci√≥n</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Panel Central - Video -->
        <div class="center-panel">
            <div class="status-indicators">
                <div class="status-dot" id="detectionIndicator" title="Detecci√≥n EPP"></div>
                <div class="status-dot" id="recognitionIndicator" title="Reconocimiento Facial"></div>
            </div>
            
            <div class="video-container">
                <img id="videoFeed" src="{{ url_for('video_feed') }}" style="display: none;" alt="Video Feed">
                <div class="placeholder" id="placeholder">
                    <div class="placeholder-icon">üìπ</div>
                    <div>√Årea de visualizaci√≥n de im√°genes</div>
                    <div class="placeholder-subtitle">
                        Cargue un archivo o active la c√°mara para comenzar
                    </div>
                </div>
            </div>

            <!-- Panel de Informaci√≥n de Detecci√≥n -->
            <div class="detection-info">
                <div class="detection-status">
                    <div class="detection-icon" id="detectionIcon">üë§</div>
                    <div>
                        <div class="detection-text" id="detectionText">Esperando detecci√≥n</div>
                        <div class="detection-time" id="detectionTime">--:-- Sistema en espera</div>
                    </div>
                </div>
                <div class="status-indicators">
                    <div class="status-dot" id="cameraStatus" title="Estado de C√°mara"></div>
                </div>
            </div>
        </div>

        <!-- Panel Derecho - M√©tricas y Estad√≠sticas -->
        <div class="right-panel">
            <!-- M√©tricas Generales -->
            <div class="metrics-card">
                <h3 class="metrics-title">M√©tricas del Sistema</h3>
                <div class="metric-item">
                    <span class="metric-label">Personas Detectadas</span>
                    <span class="metric-value" id="totalPersons">0</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">EPP Completo</span>
                    <span class="metric-value" id="completeEPP">0</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">Incidencias</span>
                    <span class="metric-value" id="incidents">0</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">Tiempo Activo</span>
                    <span class="metric-value" id="activeTime">00:00:00</span>
                </div>
            </div>

            <!-- √öltimas Detecciones -->
            <div class="metrics-card">
                <h3 class="metrics-title">√öltimas Detecciones</h3>
                <div id="recentDetections">
                    <div class="metric-item">
                        <span class="metric-label">Sin detecciones recientes</span>
                        <span class="metric-value">--:--</span>
                    </div>
                </div>
            </div>

            <!-- Estado del Sistema -->
            <div class="metrics-card">
                <h3 class="metrics-title">Estado del Sistema</h3>
                <div class="metric-item">
                    <span class="metric-label">C√°mara</span>
                    <span class="metric-value" id="cameraState">Inactiva</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">Detecci√≥n EPP</span>
                    <span class="metric-value" id="detectionState">Inactiva</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">Reconocimiento</span>
                    <span class="metric-value" id="recognitionState">Inactivo</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">Modelo</span>
                    <span class="metric-value" id="modelState">Cargado</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Panel de Controles -->
    <div class="controls-panel">
        <div class="controls-container">
            <!-- Bot√≥n 1: Cargar archivo -->
            <div class="control-btn" id="btnLoad" title="Cargar archivo de imagen o video">
                <img src="{{ url_for('static', filename='images/cargar.png') }}" alt="Cargar" class="btn-icon">
                <div class="btn-label">Cargar</div>
                <input type="file" id="fileInput" accept="image/*,video/*">
            </div>
            
            <!-- Bot√≥n 2: Abrir Excel -->
            <div class="control-btn" id="btnExcel" title="Abrir registro de asistencia">
                <img src="{{ url_for('static', filename='images/color.png') }}" alt="Excel" class="btn-icon">
                <div class="btn-label">Registros</div>
            </div>
            
            <!-- Bot√≥n 3: Reconocimiento facial -->
            <div class="control-btn" id="btnRecognition" title="Activar/Desactivar reconocimiento facial">
                <img src="{{ url_for('static', filename='images/gris.png') }}" alt="Reconocimiento" class="btn-icon">
                <div class="btn-label">Rostros</div>
            </div>
            
            <!-- Bot√≥n 4: Detecci√≥n EPP -->
            <div class="control-btn" id="btnDetection" title="Activar/Desactivar detecci√≥n de EPP">
                <img src="{{ url_for('static', filename='images/deteccion.png') }}" alt="Detecci√≥n" class="btn-icon">
                <div class="btn-label">EPP</div>
            </div>
            
            <!-- Bot√≥n 5: Capturar -->
            <div class="control-btn" id="btnCapture" title="Capturar imagen actual">
                <img src="{{ url_for('static', filename='images/descarga.png') }}" alt="Capturar" class="btn-icon">
                <div class="btn-label">Capturar</div>
            </div>
            
            <!-- Bot√≥n 6: C√°mara -->
            <div class="control-btn" id="btnCamera" title="Activar c√°mara en tiempo real">
                <img src="{{ url_for('static', filename='images/camara.png') }}" alt="C√°mara" class="btn-icon">
                <div class="btn-label">C√°mara</div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>